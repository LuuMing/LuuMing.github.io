<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.3.0',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="LuMing&#39;s blog">
<meta property="og:url" content="http://LuuMing.github.io/index.html">
<meta property="og:site_name" content="LuMing&#39;s blog">
<meta property="og:locale" content="zh">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LuMing&#39;s blog">






  <link rel="canonical" href="http://LuuMing.github.io/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>LuMing's blog</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4becdc28b5402c3ae70e696799455f76";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LuMing's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://LuuMing.github.io/2018/10/24/1024/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LuMing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuMing's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/24/1024/" itemprop="url">
                  1024
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-24 17:42:23 / Modified: 21:27:27" itemprop="dateCreated datePublished" datetime="2018-10-24T17:42:23+08:00">2018-10-24</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>一个数字的相反数等于它本身
</code></pre><p>或许只有在计算机界中，这样的数字有两个：一个是<code>0</code>，一个是<code>2147483648</code>（32位 int）。<br>在今年的<code>1024</code>里碰到这个 <code>bug</code>，告诉了我<code>界</code>的重要性。</p>
<p>代码一直在写，单词一直在背，步一直在跑。</p>
<p>就奔着这个塔尖而去吧（斜眼笑）：<br><img src="/2018/10/24/1024/1.jpg" alt="1.jpg"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://LuuMing.github.io/2018/10/21/detachment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LuMing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuMing's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/21/detachment/" itemprop="url">
                  《超脱》
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-21 09:55:29 / Modified: 12:36:36" itemprop="dateCreated datePublished" datetime="2018-10-21T09:55:29+08:00">2018-10-21</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这几句<a href="https://movie.douban.com/subject/5322596/" target="_blank" rel="noopener">台词</a>总是不时地在脑中浮现：</p>
<pre><code>UBIQUITOUS
ASSIMILATE
&quot;Awlay absorbing everything everwhere all the time.&quot;
...
How are you to imagine anything, if the images are always provide for you?
...
DOUBLETHINK
To deliberately believe in lies while knowing they&#39;re false. Examples of this  in everyday life: oh, I... need to be pretty, to be happy. I need surgery to be pretty. I need to be thin, famous, fashionable. Our young men, today, are being told that women, are whorses, bitches, thing to be screwed, beaten, shit on, ashamed. This is a marketing holocaust. 24 hours of a day, for the rest of our lives, the powers that be are hard at work, dumbing us to death. So, to defend ourselves and fight against assimilating this dullness into our thought processes, we must learn to read, to stimulate our own imaginatiion, to cultivate, our own consciousness, our own belief system. We all need these skills, to defend, to preserve, our own minds.
</code></pre><p>恩，为什么呢？</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://LuuMing.github.io/2018/10/20/translating-20180907-How-to-Use-the-Netplan-Network-Configuration-Tool-on-Linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LuMing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuMing's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/20/translating-20180907-How-to-Use-the-Netplan-Network-Configuration-Tool-on-Linux/" itemprop="url">
                  <翻译>如何在 Linux 上使用网络配置工具 Netplan
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-20 22:47:22 / Modified: 23:00:21" itemprop="dateCreated datePublished" datetime="2018-10-20T22:47:22+08:00">2018-10-20</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> netplan 是一个命令行工具，用于在某些 Linux 发行版上配置网络。</p>
<p><img src="https://www.linux.com/sites/lcom/files/styles/rendered_file/public/netplan.jpg?itok=Gu_ZfNGa" alt=""></p>
<p>多年以来 Linux 管理员和用户们以相同的方式配置他们的网络接口。例如，如果你是 Ubuntu 用户，你能够用桌面 GUI 配置网络连接，也可以在 <code>/etc/network/interfaces</code> 文件里配置。配置相当简单且可以奏效。在文件中配置看起来就像这样：</p>
<pre><code>auto enp10s0
iface enp10s0 inet static
address 192.168.1.162
netmask 255.255.255.0
gateway 192.168.1.100
dns-nameservers 1.0.0.1,1.1.1.1
</code></pre><p>保存并关闭文件。使用命令重启网络：</p>
<pre><code>sudo systemctl restart networking
</code></pre><p>或者，如果你使用不带 systemd 的发行版，你可以通过老办法来重启网络：</p>
<pre><code>sudo /etc/init.d/networking restart
</code></pre><p>你的网络将会重新启动，新的配置将会生效。</p>
<p>这就是多年以来的做法。但是现在，在某些发行版上（例如 Ubuntu Linux 18.04），网络的配置与控制发生了很大的变化。不需要那个 <code>interfaces</code> 文件和 <code>/etc/init.d/networking</code> 脚本，我们现在转向使用 <a href="https://netplan.io/" target="_blank" rel="noopener">Netplan</a>。Netplan 是一个在某些 Linux 发行版上配置网络连接的命令行工具。Netplan 使用 YAML 描述文件来配置网络接口，然后，通过这些描述为任何给定的呈现工具生成必要的配置选项。</p>
<p>我将向你展示如何在 Linux 上使用 Netplan 配置静态 IP 地址和 DHCP 地址。我会在 Ubuntu Server 18.04 上演示。有句忠告，你创建的 .yaml 文件中的缩进必须保持一致，否则将会失败。你不用为每行使用特定的缩进间距，只需保持一致就行了。</p>
<h3 id="新的配置文件"><a href="#新的配置文件" class="headerlink" title="新的配置文件"></a>新的配置文件</h3><p>打开终端窗口（或者通过 SSH 登录进 Ubuntu 服务器）。你会在 <code>/etc/netplan</code> 文件夹下发现 Netplan 的新配置文件。使用 <code>cd /etc/netplan</code> 命令进入到那个文件夹下。一旦进到了那个文件夹，也许你就能够看到一个文件：</p>
<pre><code>01-netcfg.yaml
</code></pre><p>你可以创建一个新的文件或者是编辑默认文件。如果你打算修改默认文件，我建议你先做一个备份：</p>
<pre><code>sudo cp /etc/netplan/01-netcfg.yaml /etc/netplan/01-netcfg.yaml.bak
</code></pre><p>备份好后，就可以开始配置了。</p>
<h3 id="网络设备名称"><a href="#网络设备名称" class="headerlink" title="网络设备名称"></a>网络设备名称</h3><p>在你开始配置静态 IP 之前，你需要知道设备名称。要做到这一点，你可以使用命令 <code>ip a</code>，然后找出哪一个设备将会被用到（图 1）。</p>
<p><img src="https://www.linux.com/sites/lcom/files/styles/rendered_file/public/netplan_1.jpg?itok=XuIsXWbV" alt="netplan" title="netplan"></p>
<p><em>图 1：使用 ip a 命令找出设备名称</em></p>
<p>我将为 ens5 配置一个静态的 IP。</p>
<h3 id="配置静态-IP-地址"><a href="#配置静态-IP-地址" class="headerlink" title="配置静态 IP 地址"></a>配置静态 IP 地址</h3><p>使用命令打开原来的 .yaml 文件：</p>
<pre><code>sudo nano /etc/netplan/01-netcfg.yaml
</code></pre><p>文件的布局看起来就像这样：</p>
<pre><code>network:
    Version: 2
    Renderer: networkd
    ethernets:
       DEVICE_NAME:
          Dhcp4: yes/no
          Addresses: [IP/NETMASK]
          Gateway: GATEWAY
          Nameservers:
             Addresses: [NAMESERVER, NAMESERVER]
</code></pre><p>其中：</p>
<ul>
<li><code>DEVICE_NAME</code> 是需要配置设备的实际名称。</li>
<li><code>yes</code>/<code>no</code> 代表是否启用 dhcp4。</li>
<li><code>IP</code> 是设备的 IP 地址。</li>
<li><code>NETMASK</code> 是 IP 地址的掩码。</li>
<li><code>GATEWAY</code> 是网关的地址。</li>
<li><code>NAMESERVER</code> 是由逗号分开的 DNS 服务器列表。</li>
</ul>
<p>这是一份 .yaml 文件的样例：</p>
<pre><code>network:
    version: 2
    renderer: networkd
    ethernets:
       ens5:
       dhcp4: no
       addresses: [192.168.1.230/24]
       gateway4: 192.168.1.254
       nameservers:
          addresses: [8.8.4.4,8.8.8.8]
</code></pre><p>编辑上面的文件以达到你想要的效果。保存并关闭文件。</p>
<p>注意，掩码已经不用再配置为 <code>255.255.255.0</code> 这种形式。取而代之的是，掩码已被添加进了 IP 地址中。</p>
<h3 id="测试配置"><a href="#测试配置" class="headerlink" title="测试配置"></a>测试配置</h3><p>在应用改变之前，让我们测试一下配置。为此，使用命令：</p>
<pre><code>sudo netplan try
</code></pre><p>上面的命令会在应用配置之前验证其是否有效。如果成功，你就会看到配置被接受。换句话说，Netplan 会尝试将新的配置应用到运行的系统上。如果新的配置失败了，Netplan 会自动地恢复到之前使用的配置。成功后，新的配置就会被使用。</p>
<h3 id="应用新的配置"><a href="#应用新的配置" class="headerlink" title="应用新的配置"></a>应用新的配置</h3><p>如果你确信配置文件没有问题，你就可以跳过测试环节并且直接使用新的配置。它的命令是：</p>
<pre><code>sudo netplan apply
</code></pre><p>此时，你可以使用 ip a 看看新的地址是否正确。</p>
<h3 id="配置-DHCP"><a href="#配置-DHCP" class="headerlink" title="配置 DHCP"></a>配置 DHCP</h3><p>虽然你可能不会配置 DHCP 服务，但通常还是知道比较好。例如，你也许不知道网络上当前可用的静态 IP 地址是多少。你可以为设备配置 DHCP，获取到 IP 地址，然后将那个地址重新配置为静态地址。</p>
<p>在 Netplan 上使用 DHCP，配置文件看起来就像这样：</p>
<pre><code>network:
    version: 2
    renderer: networkd
    ethernets:
       ens5:
       Addresses: []
       dhcp4: true
       optional: true
</code></pre><p>保存并退出。用下面命令来测试文件：</p>
<pre><code>sudo netplan try
</code></pre><p>Netplan 应该会成功配置 DHCP 服务。这时你可以使用 <code>ip a</code> 命令得到动态分配的地址，然后重新配置静态地址。或者，你可以直接使用 DHCP 分配的地址（但看看这是一个服务器，你可能不想这样做）。</p>
<p>也许你有不只一个的网络接口，你可以命名第二个 .yaml 文件为 <code>02-netcfg.yaml</code> 。Netplan 会按照数字顺序应用配置文件，因此 01 会在 02 之前使用。根据你的需要创建多个配置文件。</p>
<h3 id="就是这些了"><a href="#就是这些了" class="headerlink" title="就是这些了"></a>就是这些了</h3><p>不管怎样，那些就是所有关于使用 Netplan 的东西了。虽然它对于我们习惯性的配置网络地址来说是一个相当大的改变，但并不是所有人都用的惯。但这种配置方式值得一提……因此你会适应的。</p>
<p>在 Linux Foundation 和 edX 上通过 <a href="https://training.linuxfoundation.org/linux-courses/system-administration-training/introduction-to-linux" target="_blank" rel="noopener">“Introduction to Linux”</a> 课程学习更多关于 Linux 的内容。</p>
<hr>
<p>via: <a href="https://www.linux.com/learn/intro-to-linux/2018/9/how-use-netplan-network-configuration-tool-linux" target="_blank" rel="noopener">https://www.linux.com/learn/intro-to-linux/2018/9/how-use-netplan-network-configuration-tool-linux</a></p>
<p>作者：<a href="https://www.linux.com/users/jlwallen" target="_blank" rel="noopener">Jack Wallen</a><br>选题：<a href="https://github.com/lujun9972" target="_blank" rel="noopener">lujun9972</a><br>译者：<a href="https://github.com/LuuMing" target="_blank" rel="noopener">LuuMing</a><br>校对：<a href="https://github.com/wxy" target="_blank" rel="noopener">wxy</a></p>
<p>本文由 <a href="https://github.com/LCTT/TranslateProject" target="_blank" rel="noopener">LCTT</a> 原创编译，<a href="https://linux.cn/" target="_blank" rel="noopener">Linux中国</a> 荣誉推出</p>
<hr>
<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>感谢<a href="https://github.com/LCTT/TranslateProject/pull/10584/files" target="_blank" rel="noopener">校对</a>。示例代码要精简，不能照搬原文，要删除多余的空行。后面的标点符号也要注意，即使是英文的引用内容，也要使用中文的引号<code>&quot; ”</code>。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://LuuMing.github.io/2018/10/16/os-intuition/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LuMing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuMing's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/16/os-intuition/" itemprop="url">
                  操作系统讲什么
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-16 21:00:00 / Modified: 21:14:55" itemprop="dateCreated datePublished" datetime="2018-10-16T21:00:00+08:00">2018-10-16</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h3><p>约束分为 I/O 约束与 CPU 约束。这两个概念是引出操作系统设计的主要问题之一。<br>操作系统任务之一就是保证多个进程有条不紊的运行，</p>
<h3 id="进程同步"><a href="#进程同步" class="headerlink" title="进程同步"></a>进程同步</h3><p>临界区通过互斥锁保护信号量完成 PV 操作进行进程同步。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://LuuMing.github.io/2018/10/15/translating-20180709-How-To-Configure-SSH-Key-Based-Authentication-In-Linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LuMing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuMing's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/15/translating-20180709-How-To-Configure-SSH-Key-Based-Authentication-In-Linux/" itemprop="url">
                  <翻译> 如何在 Linux 中配置基于密钥认证的 SSH
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-15 11:22:45" itemprop="dateCreated datePublished" datetime="2018-10-15T11:22:45+08:00">2018-10-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-16 22:56:15" itemprop="dateModified" datetime="2018-10-16T22:56:15+08:00">2018-10-16</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://www.ostechnix.com/wp-content/uploads/2017/01/Configure-SSH-Key-based-Authentication-In-Linux-720x340.png" alt=""></p>
<h3 id="什么是基于-SSH-密钥的认证？"><a href="#什么是基于-SSH-密钥的认证？" class="headerlink" title="什么是基于 SSH 密钥的认证？"></a>什么是基于 SSH 密钥的认证？</h3><p>众所周知，<strong>Secure Shell</strong>，又称 <strong>SSH</strong>，是允许你通过无安全网络（例如 Internet）和远程系统之间安全访问/通信的加密网络协议。无论何时使用 SSH 在无安全网络上发送数据，它都会在源系统上自动地被加密，并且在目的系统上解密。SSH 提供了四种加密方式，<strong>基于密码认证</strong>，<strong>基于密钥认证</strong>，<strong>基于主机认证</strong>和<strong>键盘认证</strong>。最常用的认证方式是基于密码认证和基于密钥认证。</p>
<p>在基于密码认证中，你需要的仅仅是远程系统上用户的密码。如果你知道远程用户的密码，你可以使用 <code>ssh user@remote-system-name</code> 访问各自的系统。另一方面，在基于密钥认证中，为了通过 SSH 通信，你需要生成 SSH 密钥对，并且为远程系统上传 SSH 公钥。每个 SSH 密钥对由私钥与公钥组成。私钥应该保存在客户系统上，公钥应该上传给远程系统。你不应该将私钥透露给任何人。希望你已经对 SSH 和它的认证方式有了基本的概念。</p>
<p>这篇教程，我们将讨论如何在 Linux 上配置基于密钥认证的 SSH。</p>
<h3 id="在-Linux-上配置基于密钥认证的-SSH"><a href="#在-Linux-上配置基于密钥认证的-SSH" class="headerlink" title="在 Linux 上配置基于密钥认证的 SSH"></a>在 Linux 上配置基于密钥认证的 SSH</h3><p>为方便演示，我将使用 Arch Linux 为本地系统，Ubuntu 18.04 LTS 为远程系统。</p>
<p>本地系统详情：</p>
<ul>
<li>OS: Arch Linux Desktop</li>
<li>IP address: 192.168.225.37/24</li>
</ul>
<p>远程系统详情：</p>
<ul>
<li>OS: Ubuntu 18.04 LTS Server</li>
<li>IP address: 192.168.225.22/24</li>
</ul>
<h3 id="本地系统配置"><a href="#本地系统配置" class="headerlink" title="本地系统配置"></a>本地系统配置</h3><p>就像我之前所说，在基于密钥认证的方法中，想要通过 SSH 访问远程系统，需要将公钥上传到远程系统。公钥通常会被保存在远程系统的一个 <code>~/.ssh/authorized_keys</code> 文件中。</p>
<p><strong>注意事项</strong>：不要使用 <strong>root</strong> 用户生成密钥对，这样只有 root 用户才可以使用。使用普通用户创建密钥对。</p>
<p>现在，让我们在本地系统上创建一个 SSH 密钥对。只需要在客户端系统上运行下面的命令。</p>
<pre><code>$ ssh-keygen
</code></pre><p>上面的命令将会创建一个 2048 位的 RSA 密钥对。你需要输入两次密码。更重要的是，记住你的密码。后面将会用到它。</p>
<p><strong>样例输出</strong>：</p>
<pre><code>Generating public/private rsa key pair.
Enter file in which to save the key (/home/sk/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/sk/.ssh/id_rsa.
Your public key has been saved in /home/sk/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:wYOgvdkBgMFydTMCUI3qZaUxvjs+p2287Tn4uaZ5KyE [email protected]
The key&#39;s randomart image is:
+---[RSA 2048]----+
|+=+*= + |
|o.o=.* = |
|.oo * o + |
|. = + . o |
|. o + . S |
| . E . |
| + o |
| +.*o+o |
| .o*=OO+ |
+----[SHA256]-----+
</code></pre><p>如果你已经创建了密钥对，你将看到以下信息。输入 <code>y</code> 就会覆盖已存在的密钥。</p>
<pre><code>/home/username/.ssh/id_rsa already exists.
Overwrite (y/n)?
</code></pre><p>请注意<strong>密码是可选的</strong>。如果你输入了密码，那么每次通过 SSH 访问远程系统时都要求输入密码，除非你使用了 SSH 代理保存了密码。如果你不想要密码（虽然不安全），简单地敲两次回车。不过，我建议你使用密码。从安全的角度来看，使用无密码的 ssh 密钥对不是什么好主意。这种方式应该限定在特殊的情况下使用，例如，没有用户介入的服务访问远程系统。（例如，用 <code>rsync</code> 远程备份……）</p>
<p>如果你已经在个人文件 <code>~/.ssh/id_rsa</code> 中有了无密码的密钥，但想要更新为带密码的密钥。使用下面的命令：</p>
<pre><code>$ ssh-keygen -p -f ~/.ssh/id_rsa
</code></pre><p><strong>样例输出</strong>：</p>
<pre><code>Enter new passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved with the new passphrase.
</code></pre><p>现在，我们已经在本地系统上创建了密钥对。接下来，使用下面的命令将 SSH 公钥拷贝到你的远程 SSH 服务端上。</p>
<pre><code>$ ssh-copy-id sk@192.168.225.22
</code></pre><p>在这里，我把本地（Arch Linux）系统上的公钥拷贝到了远程系统（Ubuntu 18.04 LTS）上。从技术上讲，上面的命令会把本地系统 <code>~/.ssh/id_rsa.pub</code> 文件中的内容拷贝到远程系统 <code>~/.ssh/authorized_keys</code> 中。明白了吗？非常棒。</p>
<p>输入 <code>yes</code> 来继续连接你的远程 SSH 服务端。接着，输入远程系统用户  <code>sk</code> 的密码。</p>
<pre><code>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
sk@192.168.225.22&#39;s password:

Number of key(s) added: 1

Now try logging into the machine, with: &quot;ssh &#39;sk@192.168.225.22&#39;&quot;
and check to make sure that only the key(s) you wanted were added.
</code></pre><p>如果你已经拷贝了密钥，但想要替换为新的密码，使用 <code>-f</code> 选项覆盖已有的密钥。</p>
<pre><code>$ ssh-copy-id -f sk@192.168.225.22
</code></pre><p>我们现在已经成功地将本地系统的 SSH 公钥添加进了远程系统。现在，让我们在远程系统上完全禁用掉基于密码认证的方式。因为我们已经配置了密钥认证，因此不再需要密码认证了。</p>
<h3 id="在远程系统上禁用基于密码认证的-SSH"><a href="#在远程系统上禁用基于密码认证的-SSH" class="headerlink" title="在远程系统上禁用基于密码认证的 SSH"></a>在远程系统上禁用基于密码认证的 SSH</h3><p>你需要在 root 用户或者 <code>sudo</code> 执行下面的命令。</p>
<p>禁用基于密码的认证，你需要在远程系统的终端里编辑 <code>/etc/ssh/sshd_config</code> 配置文件：</p>
<pre><code>$ sudo vi /etc/ssh/sshd_config
</code></pre><p>找到下面这一行，去掉注释然后将值设为 <code>no</code>：</p>
<pre><code>PasswordAuthentication no
</code></pre><p>重启 ssh 服务让它生效。</p>
<pre><code>$ sudo systemctl restart sshd
</code></pre><h3 id="从本地系统访问远程系统"><a href="#从本地系统访问远程系统" class="headerlink" title="从本地系统访问远程系统"></a>从本地系统访问远程系统</h3><p>在本地系统上使用命令 SSH 你的远程服务端：</p>
<pre><code>$ ssh sk@192.168.225.22
</code></pre><p>输入密码。</p>
<p><strong>样例输出</strong>：</p>
<pre><code>Enter passphrase for key &#39;/home/sk/.ssh/id_rsa&#39;:
Last login: Mon Jul 9 09:59:51 2018 from 192.168.225.37
sk@ubuntuserver:~$
</code></pre><p>现在，你就能 SSH 你的远程系统了。如你所见，我们已经使用之前 <code>ssh-keygen</code> 创建的密码登录进了远程系统的账户，而不是使用当前账户实际的密码。</p>
<p>如果你试图从其它客户端系统 ssh（远程系统），你将会得到这条错误信息。比如，我试图通过命令从 CentOS SSH 访问 Ubuntu 系统：</p>
<p><strong>样例输出</strong>：</p>
<pre><code>The authenticity of host &#39;192.168.225.22 (192.168.225.22)&#39; can&#39;t be established.
ECDSA key fingerprint is 67:fc:69:b7:d4:4d:fd:6e:38:44:a8:2f:08:ed:f4:21.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &#39;192.168.225.22&#39; (ECDSA) to the list of known hosts.
Permission denied (publickey).
</code></pre><p>如你所见，除了 CentOS（LCTT 译注：根据上文，这里应该是 Arch）系统外，我不能通过其它任何系统 SSH 访问我的远程系统 Ubuntu 18.04。</p>
<h3 id="为-SSH-服务端添加更多客户端系统的密钥"><a href="#为-SSH-服务端添加更多客户端系统的密钥" class="headerlink" title="为 SSH 服务端添加更多客户端系统的密钥"></a>为 SSH 服务端添加更多客户端系统的密钥</h3><p>这点非常重要。就像我说过的那样，除非你配置过（在之前的例子中，是 Ubuntu），否则你不能通过 SSH 访问到远程系统。如果我希望给更多客户端予以权限去访问远程 SSH 服务端，我应该怎么做？很简单。你需要在所有的客户端系统上生成 SSH 密钥对并且手动拷贝 ssh 公钥到想要通过 ssh 访问的远程服务端上。</p>
<p>在客户端系统上创建 SSH 密钥对，运行：</p>
<pre><code>$ ssh-keygen
</code></pre><p>输入两次密码。现在，ssh 密钥对已经生成了。你需要手动把公钥（不是私钥）拷贝到远程服务端上。</p>
<p>使用以下命令查看公钥：</p>
<pre><code>$ cat ~/.ssh/id_rsa.pub
</code></pre><p>应该会输出类似下面的信息：</p>
<pre><code>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCt3a9tIeK5rPx9p74/KjEVXa6/OODyRp0QLS/sLp8W6iTxFL+UgALZlupVNgFjvRR5luJ9dLHWwc+d4umavAWz708e6Na9ftEPQtC28rTFsHwmyLKvLkzcGkC5+A0NdbiDZLaK3K3wgq1jzYYKT5k+IaNS6vtrx5LDObcPNPEBDt4vTixQ7GZHrDUUk5586IKeFfwMCWguHveTN7ykmo2EyL2rV7TmYq+eY2ZqqcsoK0fzXMK7iifGXVmuqTkAmZLGZK8a3bPb6VZd7KFum3Ezbu4BXZGp7FVhnOMgau2kYeOH/ItKPzpCAn+dg3NAAziCCxnII9b4nSSGz3mMY4Y7 ostechnix@centosserver
</code></pre><p>拷贝所有内容（通过 USB 驱动器或者其它任何介质），然后去你的远程服务端的终端，像下面那样，在 <code>$HOME</code> 下创建文件夹叫做 <code>.ssh</code>。你需要以 root 身份执行命令（注：不一定需要 root）。</p>
<pre><code>$ mkdir -p ~/.ssh
</code></pre><p>现在，将前几步创建的客户端系统的公钥添加进文件中。</p>
<pre><code>echo {Your_public_key_contents_here} &gt;&gt; ~/.ssh/authorized_keys
</code></pre><p>在远程系统上重启 ssh 服务。现在，你可以在新的客户端上 SSH 远程服务端了。</p>
<p>如果觉得手动添加 ssh 公钥有些困难，在远程系统上暂时性启用密码认证，使用 <code>ssh-copy-id</code> 命令从本地系统上拷贝密钥，最后禁用密码认证。</p>
<p><strong>推荐阅读：</strong></p>
<ul>
<li><a href="https://www.ostechnix.com/sslh-share-port-https-ssh/" target="_blank" rel="noopener">SSLH – Share A Same Port For HTTPS And SSH</a></li>
<li><a href="https://www.ostechnix.com/scanssh-fast-ssh-server-open-proxy-scanner/" target="_blank" rel="noopener">ScanSSH – Fast SSH Server And Open Proxy Scanner</a></li>
</ul>
<p>好了，到此为止。基于密钥认证的 SSH 提供了一层防止暴力破解的额外保护。如你所见，配置密钥认证一点也不困难。这是一个非常好的方法让你的 Linux 服务端安全可靠。</p>
<p>不久我会带来另一篇有用的文章。请继续关注 OSTechNix。</p>
<p>干杯！</p>
<hr>
<p>via: <a href="https://www.ostechnix.com/configure-ssh-key-based-authentication-linux/" target="_blank" rel="noopener">https://www.ostechnix.com/configure-ssh-key-based-authentication-linux/</a></p>
<p>作者：<a href="https://www.ostechnix.com/author/sk/" target="_blank" rel="noopener">SK</a><br>选题：<a href="https://github.com/lujun9972" target="_blank" rel="noopener">lujun9972</a><br>译者：<a href="https://github.com/LuuMing" target="_blank" rel="noopener">LuuMing</a><br>校对：<a href="https://github.com/pityonline" target="_blank" rel="noopener">pityonline</a></p>
<p>本文由 <a href="https://github.com/LCTT/TranslateProject" target="_blank" rel="noopener">LCTT</a> 原创编译，<a href="https://linux.cn/" target="_blank" rel="noopener">Linux中国</a> 荣誉推出</p>
<hr>
<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>感谢<a href="https://github.com/LCTT/TranslateProject/pull/10501/files" target="_blank" rel="noopener">校对</a>，除了空格的使用需要注意外，对于特殊内容应该使用` `来标记。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://LuuMing.github.io/2018/10/12/learning-mind-method/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LuMing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuMing's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/12/learning-mind-method/" itemprop="url">
                  学习的两种心法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-12 23:10:02 / Modified: 23:11:15" itemprop="dateCreated datePublished" datetime="2018-10-12T23:10:02+08:00">2018-10-12</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1.将自己变复杂<br>关键字:类比 归纳 联想 总结<br>2.将自己变简单<br>关键字:死磕 致知 探索 深究<br>这两种心法在实际运用中不是非此即彼的，而在于一个度的把握。<br>二者共同的源泉是“纯粹”。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://LuuMing.github.io/2018/10/05/githubAPI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LuMing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuMing's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/05/githubAPI/" itemprop="url">
                  githubAPI
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-05 23:22:00 / Modified: 23:22:48" itemprop="dateCreated datePublished" datetime="2018-10-05T23:22:00+08:00">2018-10-05</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用 githubAPI 获取用户类型（个人/组织）：</p>
<pre><code>https://api.github.com/users/&lt; name&gt;
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://LuuMing.github.io/2018/10/03/pip/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LuMing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuMing's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/03/pip/" itemprop="url">
                  pip 的正确使用方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-03 23:34:03 / Modified: 23:45:35" itemprop="dateCreated datePublished" datetime="2018-10-03T23:34:03+08:00">2018-10-03</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天试着参加 github 上参与一个开源 python 项目。在使用 pip 工具时遇到坑：</p>
<ol>
<li>将项目克隆下来后，在其上修改</li>
<li>使用 <code>pip install 模块名</code> 。</li>
<li>发现修改后并未奏效。</li>
<li>创建新的 python 环境安装，依旧未奏效。</li>
<li>使用 <code>pip install grank --no-cache-dir</code> 禁用缓存安装，未奏效。</li>
</ol>
<p>辗转多次，最后才知道 <code>pip install</code> 是从网上下载安装，与<strong>本地无关</strong>。<br>解决办法：<br>在一般的 python 模块中，项目根目录下会有 <code>setup.py</code>，<code>requirements.txt</code>。执行 <code>pip install -r requirements.txt</code>安装必要包。使用<code>python setup.py install</code> 从本地目录进行安装即可。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://LuuMing.github.io/2018/09/29/interprocess-communication-semget/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LuMing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuMing's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/29/interprocess-communication-semget/" itemprop="url">
                  进程通信-信号量
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-09-29 23:29:23" itemprop="dateCreated datePublished" datetime="2018-09-29T23:29:23+08:00">2018-09-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-21 16:36:31" itemprop="dateModified" datetime="2018-10-21T16:36:31+08:00">2018-10-21</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><pre><code>#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/sem.h&gt;

int semget(key_t key, int nsems, int semflg);
</code></pre><h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p><code>semget()</code> 系统调用返回 <a href="https://baike.baidu.com/item/System%20V/1376562?fr=aladdin" target="_blank" rel="noopener">System V</a> 系统中的一个信号量标识符并给参数<code>key</code>。</p>
<p>via: <a href="http://man7.org/linux/man-pages/man2/semget.2.html" target="_blank" rel="noopener">http://man7.org/linux/man-pages/man2/semget.2.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://LuuMing.github.io/2018/09/23/interprocess-communication-pipe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LuMing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuMing's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/23/interprocess-communication-pipe/" itemprop="url">
                  进程通信的实现--管道
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-09-23 12:24:41" itemprop="dateCreated datePublished" datetime="2018-09-23T12:24:41+08:00">2018-09-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-26 19:04:25" itemprop="dateModified" datetime="2018-09-26T19:04:25+08:00">2018-09-26</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><pre><code>
  #include &lt;unistd.h&gt;

       int pipe(int pipefd[2]);

       #define _GNU_SOURCE             /* See feature_test_macros(7) */
       #include &lt;fcntl.h&gt;              /* Obtain O_* constant definitions */
       #include &lt;unistd.h&gt;

       int pipe2(int pipefd[2], int flags);

</code></pre><h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p><code>pipe()</code> 创建一个单向的可用作进程间通信的数据通道。<code>pipefd</code>数组用作返回管道两端的文件描述符。<code>pipefd[0]</code>代表管道的读取端。<code>pipefd[1]</code>用作写入端。数据被写入到由内核所缓冲的管道写入端。</p>
<p>如果 <code>flags</code> 为 0，那么<code>pipe2()</code>就和<code>pipe()</code>一样。下面这些变量可以在<code>flags</code>中按位或运算来获得不同的功能：</p>
<h4 id="O-CLOEXEC"><a href="#O-CLOEXEC" class="headerlink" title="O_CLOEXEC"></a>O_CLOEXEC</h4><p>为两个文件描述符设置<code>close-on-exec (FD_CLOEXEC)</code>标志。在 <a href="http://man7.org/linux/man-pages/man2/open.2.html" target="_blank" rel="noopener">open</a> 中查看相同标志的描述，了解它为什么非常有用。</p>
<h4 id="O-DIRECT-自从-Linux-3-4"><a href="#O-DIRECT-自从-Linux-3-4" class="headerlink" title="O_DIRECT( 自从 Linux 3.4 )"></a>O_DIRECT( 自从 Linux 3.4 )</h4><p>创建一个在 <strong>packet</strong> 模式下执行 I/O 的管道。每次对管道的 write 都被当作分开的包处理，并且每次从管道中 read 都会依次读取一个包。注意以下几点：</p>
<ul>
<li>写入超过 <strong>PIPE_BUF</strong> 字节（查看 <a href="http://man7.org/linux/man-pages/man7/pipe.7.html" target="_blank" rel="noopener">pipe(7)</a>）将会分为多个包。常数 <strong>PIPE_BUF</strong>定义在 <code>&lt;limits.h&gt;</code>中。</li>
<li>如果 <a href="http://man7.org/linux/man-pages/man2/read.2.html" target="_blank" rel="noopener">read</a> 确定的缓冲区大小比下一个包小，这时，包中需要的字节被读取，超出的字节被丢弃。指定缓冲区大小为 <strong>PIPE_BUF</strong> 就足以读取尽可能大的包。</li>
<li>不支持 0 长度的包。（read 指定缓冲区大小为 0 是一个空操作，返回 0。）<br>老版本内核不支持这个标志将会通过 <strong>EINVAL</strong> 错误指出。<br>自从 Linux 4.5，可以通过 <a href="http://man7.org/linux/man-pages/man2/fcntl.2.html" target="_blank" rel="noopener">fcntl</a> 改变管道文件描述符的 <strong>O_DIRECT</strong> 设置。</li>
</ul>
<h4 id="O-NONBLOCK"><a href="#O-NONBLOCK" class="headerlink" title="O_NONBLOCK"></a>O_NONBLOCK</h4><p>为两个新开的文件描述符设置 O_NONBLOCK 文件状态标志。使用这个标志节省额外的 <strong>fcntl</strong> 调用以达到同样的效果。</p>
<h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>成功，返回 0。错误，返回 -1 并且设置 errno。<br>在 Linux 上（和其他的系统），<strong>pipe()</strong>不在失败时修改<strong>pipefd</strong>。在 POSIX.1-2016 中添加了规范这一行为的要求。Linux 规定的 <strong>pipe2()</strong> 系统调用同样在失败时不修改 <strong>pipefd</strong>。</p>
<h3 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h3><ul>
<li>EFAULT 无效 pipefd</li>
<li>EINVAL（pipe2()）flags 值非法</li>
<li>EMFILE 达到之前进程所限制的打开文件描述符的数目</li>
<li>ENFILE 达到系统所限制的打开文件描述符的数目</li>
<li>ENFILE 管道空间达到用户强行限制的内存，或者调用者没有权限。查看<a href="http://man7.org/linux/man-pages/man7/pipe.7.html" target="_blank" rel="noopener">pipe(7)</a></li>
</ul>
<h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><p><strong>pipe2()</strong>在 Linux 2.6.27 中被添加进去；glibc 支持从 2.9 版本后开始。</p>
<h3 id="标准"><a href="#标准" class="headerlink" title="标准"></a>标准</h3><p><strong>pipe()</strong>: POSIX.1-2001,POSIX.1-2008。<br><strong>pipe2()</strong> 是 Linux 特有。</p>
<h3 id="范例"><a href="#范例" class="headerlink" title="范例"></a>范例</h3><p>下面的程序创建一个管道，然后 <strong>frok</strong> 去创建一个子进程。子进程继承了一套指向同一管道的文件描述符。<strong>fork</strong> 之后，每个进程关闭了管道不需要的文件描述符。父进程这时写入管道从命令行参数获取的字符串，然后子进程依次按字节读取这个字符串并显示在标准输出上。</p>
<pre><code>
      #include &lt;sys/types.h&gt;
       #include &lt;sys/wait.h&gt;
       #include &lt;stdio.h&gt;
       #include &lt;stdlib.h&gt;
       #include &lt;unistd.h&gt;
       #include &lt;string.h&gt;

       int
       main(int argc, char *argv[])
       {
           int pipefd[2];
           pid_t cpid;
           char buf;

           if (argc != 2) {
               fprintf(stderr, &quot;Usage: %s &lt;string&gt;\n&quot;, argv[0]);
               exit(EXIT_FAILURE);
           }

           if (pipe(pipefd) == -1) {
               perror(&quot;pipe&quot;);
               exit(EXIT_FAILURE);
           }

           cpid = fork();
           if (cpid == -1) {
               perror(&quot;fork&quot;);
               exit(EXIT_FAILURE);
           }

           if (cpid == 0) {    /* Child reads from pipe */
               close(pipefd[1]);          /* Close unused write end */

               while (read(pipefd[0], &amp;buf, 1) &gt; 0)
                   write(STDOUT_FILENO, &amp;buf, 1);

               write(STDOUT_FILENO, &quot;\n&quot;, 1);
               close(pipefd[0]);
               _exit(EXIT_SUCCESS);

           } else {            /* Parent writes argv[1] to pipe */
               close(pipefd[0]);          /* Close unused read end */
               write(pipefd[1], argv[1], strlen(argv[1]));
               close(pipefd[1]);          /* Reader will see EOF */
               wait(NULL);                /* Wait for child */
               exit(EXIT_SUCCESS);
           }
       }
</code></pre><hr>
<p>via: <a href="http://man7.org/linux/man-pages/man2/pipe.2.html" target="_blank" rel="noopener">http://man7.org/linux/man-pages/man2/pipe.2.html</a></p>
<p>译者：<a href="https://github.com/LuuMing" target="_blank" rel="noopener">LuuMing</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">LuMing</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">45</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/LuuMing" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:784315443@qq.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LuMing</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Muse</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



  










  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  

  

</body>
</html>
